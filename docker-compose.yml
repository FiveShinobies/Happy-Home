services:
  # -------------------- MySQL --------------------
  mysql:
    image: mysql:8
    container_name: happyhome-mysql
    restart: always
    environment:
      MYSQL_DATABASE: happyhome
      MYSQL_USER: D3_92602_Amol
      MYSQL_PASSWORD: manager
      MYSQL_ROOT_PASSWORD: root
    volumes:
      - mysql_data:/var/lib/mysql
    ports:
      - "3306:3306"   # optional (for Workbench)

  # -------------------- Backend (Spring Boot) --------------------
  backend:
    image: 23amol08/happy-home-backend:latest
    container_name: happyhome-backend
    depends_on:
      - mysql
    ports:
      - "8080:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/happyhome?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: D3_92602_Amol
      SPRING_DATASOURCE_PASSWORD: manager

      JWT_SECRET: acvhnanvavnioqvnijvaj vanv qavnqovnqoivnqoivn qvbjqbvqjabv;
      JWT_EXPIRATION: 86400000

      RAZORPAY_KEY_ID: rzp_test_S7bivnJVMPGoc0
      RAZORPAY_KEY_SECRET: mUo2vpaac1o7dAhe4FK3dqOU

      NOTIFICATION_SERVICE_URL: http://notification-service:5253
    restart: always

  # -------------------- Frontend (React + Nginx) --------------------
  frontend:
    build:
      context: ./happy-home        # âœ… CORRECT
      dockerfile: Dockerfile
     
    container_name: happyhome-frontend
    depends_on:
      - backend
    ports:
      - "80:80"
    restart: always

  # -------------------- MongoDB --------------------
  mongo-notification:
    image: mongo:7
    container_name: happyhome-mongo-notification
    restart: always
    volumes:
      - mongo_notification_data:/data/db
    ports:
      - "27017:27017"   # optional

  # -------------------- Notification Service (.NET 8) --------------------
  notification-service:
    image: 23amol08/happy-home-notification-service:latest
    container_name: happyhome-notification
    depends_on:
      - mongo-notification
    ports:
      - "5253:5253"
    environment:
      ASPNETCORE_URLS: http://+:5253
      MONGO_CONNECTION_STRING: mongodb://mongo-notification:27017/notifications
    restart: always

# -------------------- Volumes --------------------
volumes:
  mysql_data:
  mongo_notification_data:
